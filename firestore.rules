rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /games/{gameId} {
      // Un usuario solo puede leer un juego si es parte de él.
      // Se comprueba la existencia de su UID en el mapa `playerUids`.
      allow read: if request.auth != null && resource.data.playerUids[request.auth.uid] == true;
      
      // La creación, actualización y eliminación de salas debe ser solo a través de acciones de servidor seguras.
      allow write: if false;

      // Subcolección para los datos privados de los jugadores
      match /playerData/{userId} {
        // Un jugador solo puede leer su propio documento de datos privados.
        allow read: if request.auth != null && request.auth.uid == userId;

        // Las escrituras deben ser manejadas por el servidor.
        allow write: if false; 
      }
    }
  }
}
